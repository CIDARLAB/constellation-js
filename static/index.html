<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
      
    <link rel="stylesheet" href="codemirror.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="base16-light.css">
 

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gojs/1.8.2/go-debug.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <script src="codemirror.js"></script>
    <script src="scheme.js"></script>
    

    <title>Constellation</title>

  </head>
  
  
  <body>
  
      <h3>Constellation</h3>
  
      <textarea class ="codemirror" id="langInput" style="height: 200px; width:100%" name="paragraph_text" cols="50" rows="10"></textarea>
  

      <input id="submitBtn" type="button" value="Submit">
      <br><br>
  
      <div id="stateGraph" style="border: solid 1px black; width: 100%; height: 400px"></div>
  

      <script>
        const THEME = "base16-light";


        var specEditor = CodeMirror.fromTextArea(document.getElementById('langInput'), {
          lineNumbers: true,
        });

        specEditor.setOption("theme", THEME);


        var myDiagram = null;
        
        $(document).ready(function() {
          $("#submitBtn").click(function(){
            if (myDiagram) {
              myDiagram.div = null;
            }
           
            myDiagram = initializeStateGraph();

            var specification = $('#langInput').val();

            var categories = '{"promoter": ["BBa_R0040", "BBa_J23100"], "rbs": ["BBa_B0032", "BBa_B0034"], "cds": ["BBa_E0040", "BBa_E1010"], "terminator": ["BBa_B0010"]}';
            // var categories = '{"a":["a1","a2","a3"],"b":["b1","b2","b3"],"c":["c1"],"d":[]}';

            $.post('http://localhost:8082/postSpecs', {
              "specification": specification,
              "categories": categories,
              "number": "2.0",
              "name": "specificationname",
              "clientid": "userid" 
            }, function(data, status) {
              displayDiagram(data.stateGraph);
              console.log('data received: ', data);
            });
          });
        });

/* * * * * * * */
/*   DIAGRAM   */
/* * * * * * * */

// Returns an empty Go Diagram object
function initializeStateGraph() {
  
  
    var g = go.GraphObject.make;
    myDiagram = g(go.Diagram, 'stateGraph', {
      initialContentAlignment: go.Spot.Center
    });
  
    return myDiagram;
  }


// Translates adjacency list to Go graph representation
function displayDiagram(stateGraph) {
 

  var nodes = [];
  var edges = [];

  for (id in stateGraph) {
    
    var text = stateGraph[id].text;

    nodes.push({key: id, text: text});
    
    var nodeEdges = stateGraph[id].edges;
    for (var i = 0; i < nodeEdges.length; i++) {
      edges.push({from: id, to: nodeEdges[i]});
    }
  }

  
  // var root = getRootNode(stateGraph);
  // // for graph clarity purposes
  // root.text = 'root';  
  myDiagram.model = new go.GraphLinksModel(nodes, edges);
}
            
      </script>
  </body>


  
  </html>